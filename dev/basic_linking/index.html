<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Linking Basics · WRDSMerger.jl</title><meta name="title" content="Linking Basics · WRDSMerger.jl"/><meta property="og:title" content="Linking Basics · WRDSMerger.jl"/><meta property="twitter:title" content="Linking Basics · WRDSMerger.jl"/><meta name="description" content="Documentation for WRDSMerger.jl."/><meta property="og:description" content="Documentation for WRDSMerger.jl."/><meta property="twitter:description" content="Documentation for WRDSMerger.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">WRDSMerger.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../download_data/">Downloading WRDS Data</a></li><li><span class="tocitem">Links Between WRDS Data</span><ul><li class="is-active"><a class="tocitem" href>Linking Basics</a><ul class="internal"><li><a class="tocitem" href="#Downloading-and-Saving-Data"><span>Downloading and Saving Data</span></a></li><li><a class="tocitem" href="#Linking-Identifiers"><span>Linking Identifiers</span></a></li><li><a class="tocitem" href="#Generating-LinkPair-Functions"><span>Generating LinkPair Functions</span></a></li></ul></li><li><a class="tocitem" href="../default_behavior/">Default Behavior</a></li><li><a class="tocitem" href="../linking_identifiers/">Identifier Types</a></li><li><a class="tocitem" href="../linking_internals/">Internals</a></li></ul></li><li><a class="tocitem" href="../misc_utilities/">Miscellaneous Utilities</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Links Between WRDS Data</a></li><li class="is-active"><a href>Linking Basics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Linking Basics</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/junder873/WRDSMerger.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/junder873/WRDSMerger.jl/blob/master/docs/src/basic_linking.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Basics-of-Linking-Identifiers"><a class="docs-heading-anchor" href="#Basics-of-Linking-Identifiers">Basics of Linking Identifiers</a><a id="Basics-of-Linking-Identifiers-1"></a><a class="docs-heading-anchor-permalink" href="#Basics-of-Linking-Identifiers" title="Permalink"></a></h1><p>A core part of this package is to provide a simple and consistent interface for linking different identifiers in WRDS. One of the primary goals is to reduce the overhead of remembering how exactly to link one dataset to another.</p><h2 id="Downloading-and-Saving-Data"><a class="docs-heading-anchor" href="#Downloading-and-Saving-Data">Downloading and Saving Data</a><a id="Downloading-and-Saving-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Downloading-and-Saving-Data" title="Permalink"></a></h2><p>To do so, first download the necessary data from WRDS. This package provides download functions to do so (see <a href="../linking_internals/#Linking-Download-Functions">Linking Download Functions</a>), which are automatically called by respective generating functions (see <a href="#Generating-LinkPair-Functions">Generating LinkPair Functions</a>). The generating functions take in a <code>DataFrame</code> (which expects certain column names) and creates the necessary functions between its identifiers. Finally, calling <code>create_all_links()</code> will create the remaining links that the tables do not provide.</p><p>To provide an example:</p><pre><code class="language-julia hljs">julia&gt; db = ODBC.Connection(&quot;wrds-pgdata-64&quot;);
julia&gt; generate_crsp_links(db) # downloads the data, creates links between 
# Permno &lt;-&gt; Permco, Permno &lt;-&gt; NCusip, etc.
# and returns the data that is downloaded

julia&gt; generate_comp_crsp_links(db) # similar to generate_crsp_links

julia&gt; create_all_links() # defines functions between NCusip &lt;-&gt; GVKey, 
# Ticker &lt;-&gt; GVKey, etc.</code></pre><p>The generate functions return the DataFrame that is downloaded so you can save it locally (with CSV.jl, Arrow.jl, etc.) and can use again as opposed to re-downloading the data.</p><p>This package also provides a simple function that runs all of these:</p><pre><code class="language-julia hljs">julia&gt; download_all_links(db)</code></pre><p>Which downloads all 6 default tables and returns those 6 DataFrames. Note that if your WRDS account lacks access to one of the tables, you need to change which items are downloaded.</p><p>For example, the code I use when starting a project is:</p><pre><code class="language-julia hljs">data_dir = joinpath(path_to_saved_files)
dfs = download_all_links(db)
files = [
    &quot;crsp_links&quot;,
    &quot;crsp_comp_links&quot;,
    &quot;gvkey_cik_links&quot;,
    &quot;ibes_links&quot;,
    &quot;option_links&quot;,
    &quot;ravenpack_links&quot;
]
# I prefer Arrow.jl and feather files, replace with CSV.jl if desired
for (df, file) in zip(dfs, files)
    Arrow.write(joinpath(data_dir, file * &quot;.feather&quot;), df)
end</code></pre><p>Then, whenever I reload the project:</p><pre><code class="language-julia hljs">funs=[
    generate_crsp_links,
    generate_comp_crsp_links,
    generate_comp_cik_links,
    generate_ibes_links,
    generate_option_crsp_links,
    generate_ravenpack_links
]
for (file, f) in zip(files, funs)
    @chain joinpath(data_dir, file * &quot;.feather&quot;) begin
        Arrow.Table
        DataFrame
        copy
        f
    end
end
create_all_links()</code></pre><h2 id="Linking-Identifiers"><a class="docs-heading-anchor" href="#Linking-Identifiers">Linking Identifiers</a><a id="Linking-Identifiers-1"></a><a class="docs-heading-anchor-permalink" href="#Linking-Identifiers" title="Permalink"></a></h2><p>Once the initial data is downloaded and necessary functions are created, the package provides a consistent set of methods to convert one identifier to any other. This follows the pattern:</p><pre><code class="nohighlight hljs">(ID You Want)((ID You Have)(value), Date for conversion)</code></pre><p>For example:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; GVKey(Permno(47896), Date(2020))</code><code class="nohighlight hljs ansi" style="display:block;">&quot;002968&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; NCusip(CIK(19617), Date(2020)) # works for Int or String</code><code class="nohighlight hljs ansi" style="display:block;">&quot;46625H10&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; CIK(Permno(47896), Date(2020))</code><code class="nohighlight hljs ansi" style="display:block;">&quot;0000019617&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; CIK(NCusip(&quot;46625H21&quot;), Date(2020))</code><code class="nohighlight hljs ansi" style="display:block;">&quot;0000019617&quot;</code></pre><p>As you can see, this includes cases where there is not a table providing a direct link (CIK &lt;-&gt; Permno, CIK &lt;-&gt; NCusip). This makes it easy to link the varied datasets in WRDS.</p><p>These functions can be easily used with broadcasting:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; GVKey.(Permno.([47896, 44206, 46703]), Date(2020))</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: UndefVarError: `GVKey` not defined</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; GVKey.(Permno.([47896, 44206, 46703]), [Date(2018), Date(2019), Date(2020)])</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: UndefVarError: `GVKey` not defined</code></pre><p>Or with other packages such as <a href="https://juliadata.github.io/DataFramesMeta.jl/stable/">DataFramesMeta.jl</a>:</p><pre><code class="language-julia hljs">@chain df begin
    @rtransform(:gvkey = GVKey(Permno(:permno), :date))
end</code></pre><p>All of the identifiers that this package provides by default are seen in <a href="../linking_identifiers/#Identifier-Types">Identifier Types</a>. This is expandable as discussed in <a href="../linking_internals/#Adding-New-Identifiers">Adding New Identifiers</a>.</p><h2 id="Generating-LinkPair-Functions"><a class="docs-heading-anchor" href="#Generating-LinkPair-Functions">Generating LinkPair Functions</a><a id="Generating-LinkPair-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-LinkPair-Functions" title="Permalink"></a></h2><p>This section describes the default functions that exist to generate the necessary links.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="WRDSMerger.generate_crsp_links" href="#WRDSMerger.generate_crsp_links"><code>WRDSMerger.generate_crsp_links</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">generate_crsp_links(
    conn::Union{LibPQ.Connection, DBInterface.Connection};
    main_table=default_tables[&quot;crsp_stocknames&quot;],
    stockfile=default_tables[&quot;crsp_stock_data&quot;]
)

generate_crsp_links(df::AbstractDataFrame)</code></pre><p>Generates the methods linking  Permno, Permco, Cusip, NCusip, Cusip6, NCusip6 and Ticker to each other. If a database connection is provided, then it will download the table, otherwise, it can use a provided DataFrame.</p><p>The file used (<code>crsp.stocknames</code>), does not have a clear way to differentiate different priorities. The most common way is to calculate the market cap of any conflicting securities to determine the best option. The ideal is the market cap on the relevant day, but since this needs a static value, the default download is to average the market cap over the relevant period.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/junder873/WRDSMerger.jl/blob/7b16aafe4147ffea968a8b1d7ef0f24c94f2af97/src/links/creatingLinks.jl#L193-L212">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="WRDSMerger.generate_comp_crsp_links" href="#WRDSMerger.generate_comp_crsp_links"><code>WRDSMerger.generate_comp_crsp_links</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">generate_comp_crsp_links(
    conn::Union{LibPQ.Connection, DBInterface.Connection};
    main_table=default_tables[&quot;crsp_a_ccm_ccmxpf_lnkhist&quot;]
)

generate_comp_crsp_links(df::AbstractDataFrame)</code></pre><p>Generates the methods linking GVKey and Permno/Permco based on  the CRSP/Compustat merged annual file link history (<code>crsp_a_ccm.ccmxpf_lnkhist</code>). If a database connection is provided, then it will download the table, otherwise, it can use a provided DataFrame.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/junder873/WRDSMerger.jl/blob/7b16aafe4147ffea968a8b1d7ef0f24c94f2af97/src/links/creatingLinks.jl#L267-L280">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="WRDSMerger.generate_comp_cik_links" href="#WRDSMerger.generate_comp_cik_links"><code>WRDSMerger.generate_comp_cik_links</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">generate_comp_cik_links(
    conn::Union{LibPQ.Connection, DBInterface.Connection};
    main_table=default_tables[&quot;comp_company&quot;]
)

generate_comp_cik_links(df::AbstractDataFrame)</code></pre><p>Generates the methods linking GVKey and CIK based on  the Compustat company name file (<code>comp.company</code>). GVKey and CIK do not have any date conditions, so this download is relatively simple. If a database connection is provided, then it will download the table, otherwise, it can use a provided DataFrame.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/junder873/WRDSMerger.jl/blob/7b16aafe4147ffea968a8b1d7ef0f24c94f2af97/src/links/creatingLinks.jl#L324-L337">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="WRDSMerger.generate_ibes_links" href="#WRDSMerger.generate_ibes_links"><code>WRDSMerger.generate_ibes_links</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">generate_ibes_links(
    conn::Union{LibPQ.Connection, DBInterface.Connection};
    main_table=default_tables[&quot;wrdsapps_ibcrsphist&quot;]
)

generate_ibes_links(df::AbstractDataFrame)</code></pre><p>Generates the methods between IbesTicker and Permno/NCusip based on a standard WRDS file. If a database connection is provided, then it will download the table, otherwise, it can use a provided DataFrame.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/junder873/WRDSMerger.jl/blob/7b16aafe4147ffea968a8b1d7ef0f24c94f2af97/src/links/creatingLinks.jl#L139-L150">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="WRDSMerger.generate_option_crsp_links" href="#WRDSMerger.generate_option_crsp_links"><code>WRDSMerger.generate_option_crsp_links</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">generate_option_crsp_links(
    conn::Union{LibPQ.Connection, DBInterface.Connection};
    main_table=default_tables[&quot;optionm_all_secnmd&quot;]
)

generate_option_crsp_links(df::AbstractDataFrame)</code></pre><p>Generates the methods linking SecID and NCusip based on  the option names file (<code>optionm_all.secnmd</code>). This file only provides an &quot;effective date&quot;, so it is assumed that once the next &quot;effective date&quot;  occurs, the link is no longer valid. If a database connection is provided, then it will download the table, otherwise, it can use a provided DataFrame.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/junder873/WRDSMerger.jl/blob/7b16aafe4147ffea968a8b1d7ef0f24c94f2af97/src/links/creatingLinks.jl#L370-L384">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="WRDSMerger.generate_ravenpack_links" href="#WRDSMerger.generate_ravenpack_links"><code>WRDSMerger.generate_ravenpack_links</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">generate_ravenpack_links(
    conn::Union{LibPQ.Connection, DBInterface.Connection};
    main_table=default_tables[&quot;ravenpack_common_rp_entity_mapping&quot;]
)

generate_ravenpack_links(df::AbstractDataFrame)</code></pre><p>Generates the methods linking RPEntity and NCusip6 based on  the RavenPack Entity Mapping file (<code>ravenpack_common.rp_entity_mapping</code>). This file is very messy, so the automatic options make several assumptions and filters. First, when downloading the data, it filters any NCusip in the RavenPack file that is not in the <code>crsp.stocknames</code> file. Second, for each RPEntity, if the end date is missing, it assumes the next start date is the appropriate end date for the link. If a database connection is provided, then it will download the table, otherwise, it can use a provided DataFrame.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/junder873/WRDSMerger.jl/blob/7b16aafe4147ffea968a8b1d7ef0f24c94f2af97/src/links/creatingLinks.jl#L432-L449">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../download_data/">« Downloading WRDS Data</a><a class="docs-footer-nextpage" href="../default_behavior/">Default Behavior »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.0 on <span class="colophon-date" title="Tuesday 3 October 2023 21:18">Tuesday 3 October 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
